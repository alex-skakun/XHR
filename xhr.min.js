!function(t,EventCollection,EventCollectionItem){"use strict";function e(t){var e=r.findForTarget(t);return e||(e=new EventCollectionItem(t),r.add(e)),e}function EventTargetExtendable(t){if(Array.isArray(t)){var e={};t.forEach(function(t){var r=t.trim().toLowerCase(),n="on"+r;Object.defineProperty(this,n,{enumerable:!0,configurable:!1,get:function(){return e[r]||null},set:function(t){var n=e[r];n&&this.removeEventListener(r,n),"function"==typeof t&&(e[r]=t,this.addEventListener(r,t))}})},this)}}var r=new EventCollection;EventTargetExtendable.prototype.addEventListener=function(t,r){if("function"==typeof r){var n=e(this);return n.addListener(t,r)}return!1},EventTargetExtendable.prototype.removeEventListener=function(t,r){var n=e(this);return n.removeListener(t,r)},EventTargetExtendable.prototype.dispatchEvent=function(t){var r=e(this),n=r.getListenersByType(t),o=Array.prototype.slice.call(arguments,1),i=this;if(n){var s=[];n.forEach(function(t){"function"==typeof t&&s.push(t)}),s.forEach(function(t){t.apply(i,o)})}},EventTargetExtendable.prototype.removeAllListeners=function(t){var n=e(this);return t?n.removeListeners(t):r.remove(n)};for(var n=EventTargetExtendable.prototype,o=Object.keys(EventTargetExtendable.prototype),i=0,s=o.length;s>i;i++)Object.defineProperty(n,o[i],{enumerable:!1,configurable:!1,writable:!1});t.EventTargetExtendable=EventTargetExtendable}(this,function(){"use strict";function EventCollection(){var t;try{t=Map}catch(e){t=Array}this.collection=new t}return EventCollection.prototype.findForTarget=function(t){if(!Array.isArray(this.collection))return this.collection.get(t);for(var e=this.collection,r=0,n=e.length;n>r;r++){var o=e[r];if(o.target===t)return o}return null},EventCollection.prototype.add=function(t){Array.isArray(this.collection)?this.collection.push(t):this.collection.set(t.target,t)},EventCollection.prototype.remove=function(t){if(Array.isArray(this.collection)){var e=this.collection.indexOf(t);if(e>-1){var r=this.collection.splice(e,1);return 1===r.length}return!1}return this.collection["delete"](t.target)},EventCollection}(),function(){"use strict";function EventCollectionItem(t){this.target=t,this.listeners={}}return EventCollectionItem.createListenersCollection=function(){var t;try{t=Set}catch(e){t=Array}return new t},EventCollectionItem.prototype.getListenersByType=function(t){var e=this.listeners[t];return e||(e=EventCollectionItem.createListenersCollection(),this.listeners[t]=e),e},EventCollectionItem.prototype.addListener=function(t,e){var r=this.getListenersByType(t);return Array.isArray(r)?~r.indexOf(e)?!1:(r.push(e),!0):r.has(e)?!1:(r.add(e),!0)},EventCollectionItem.prototype.removeListener=function(t,e){var r=this.getListenersByType(t);if(Array.isArray(r)){var n=r.indexOf(e);if(n>-1){var o=r.splice(n,1);return 1===o.length}return!1}return r["delete"](e)},EventCollectionItem.prototype.removeListeners=function(t){var e=this.getListenersByType(t);return Array.isArray(e)?e.splice(0,e.length):e.clear(),!0},EventCollectionItem}()),function(t,XHRActions,XHRPromise,XHRCollection){"use strict";function e(t,e){var r,n,o,i,s={},a=Object.keys(u.defaults.attributes);for(o=0,i=a.length;i>o;o++)r=a[o],s[r]=u.defaults.attributes[r];if(t&&"object"==typeof t){var c=Object.keys(t);for(o=0,i=c.length;i>o;o++)r=c[o],s[r]=t[r],e[r]=t[r]}for(n=Object.keys(s),o=0,i=n.length;i>o;o++)r=n[o],e[r]=s[r]}function r(t){var e="";if(t&&"object"==typeof t){var r=[],n=Object.keys(t);n.forEach(function(e){var n=t[e];Array.isArray(n)?n.forEach(function(t){r.push(e+"="+t)}):"object"==typeof n&&n?r.push(e+"="+JSON.stringify(n)):"undefined"!=typeof n&&r.push(e+"="+n)}),r.length&&(e="?"+r.join("&"))}return e}function n(e){var r=null;if(void 0!==e){var n=e;r=n instanceof(t.ArrayBufferView||t.ArrayBuffer)||n instanceof t.Blob||n instanceof t.Document||n instanceof t.FormData?n:"object"==typeof n&&n?JSON.stringify(n):String(n)}return r}function o(t,e){var r,n,o,i,s,a,c={},p=Object.keys(u.defaults.headers);for(s=0,a=p.length;a>s;s++)o=p[s],c[o.toLowerCase()]=u.defaults.headers[o];if(e&&"object"==typeof e)for(r=Object.keys(e),s=0,a=r.length;a>s;s++)o=r[s],c[o.toLowerCase()]=e[o];for(n=Object.keys(c),s=0,a=n.length;a>s;s++)o=n[s],i=c[o],"undefined"!=typeof i&&null!==i&&t.setRequestHeader(o,String(i))}function i(t,e,r){return function(n){return"string"==typeof t?e.applyCallback(t,n,r):"function"==typeof t?t.call(this,n,e,r):void 0}}function s(t){var e;try{e=JSON.parse(t.responseText)}catch(r){e=t.responseText}return e}function a(t,e,r){try{u(t,e)}catch(n){e.applyCallback("error",n,r)}}function c(t,e,r){e.applyCallback("loadend",t,r);var n=r.response;if(""!==r.responseType&&"text"!==r.responseType||(n=s(r)),r.status>=200&&r.status<400){var o=function(t){if(e.queue.length){var n=e.getNext();if("function"==typeof n&&!e.xhrCollection.aborted){var i=e.checkInterceptor("response",r),s=function(){var i=n(t);i?i instanceof XHRActions?i.success(function(t){o(t)}).error(function(t){o(t)}):a(i,e):e.applyCallback("success",t,r)};p&&i instanceof p?i.then(s):i&&s()}}else e.applyCallback("success",t,r)};o(n)}else r.status>=400&&r.status<600&&e.applyCallback("error",n,r)}function u(t,s){if(t){if(t.url){var a,p,l=new XMLHttpRequest,f=s?s.addToQueue(l):new u.XHRPromise(l),h=!0,y=["error","timeout","progress","loadstart","load","abort","readystatechange",{type:"loadend",listener:c}];return t.method="string"==typeof t.method?t.method:u.defaults.method,void 0!==t.async&&(h=!!t.async),e(t.attributes,l),a=r(t.params),p=n(t.data),y=y.map(function(t){var e=t instanceof Object?t.type:t,r=t instanceof Object?t.listener:t,n=i(r,f,l);return l.addEventListener(e,n),{type:e,listener:n}}),f.addEventListener("destroy",function d(){f.removeEventListener("destroy",d),y.forEach(function(t){l.removeEventListener(t.type,t.listener)})}),l.addEventListener("readystatechange",function v(){l.readyState===XMLHttpRequest.OPENED&&(l.removeEventListener("readystatechange",v),o(l,t.headers),l.send(p),f.applyCallback("request",p,l))}),setTimeout(function(){f.xhrCollection.aborted?f.applyCallback("abort",null,l):l.open(t.method,t.url+a,h)},0),f.actions}throw new Error("URL option is required.")}throw new Error("Config object is required.")}var p=t.Promise;Object.defineProperty(u,"defaults",{value:{method:"GET",headers:{},attributes:{responseType:"",timeout:0}},configurable:!1,writable:!1}),Object.defineProperty(u,"interceptors",{value:{response:null,responseError:null,request:null},configurable:!0,writable:!0}),t.XHR=u,u.XHRActions=XHRActions,u.XHRPromise=XHRPromise,u.XHRCollection=XHRCollection}(this,function(){"use strict";function XHRActions(t){this._promise=t}return XHRActions.prototype.isInProgress=function(){return this._promise.inProgress},XHRActions.prototype.interceptors=function(t){return this._promise.interceptors=t,this},XHRActions.prototype.silent=function(){return this._promise.silent=!0,this},XHRActions.prototype.error=function(t){return this._promise.addEventListener("error",t),this},XHRActions.prototype.loadStart=function(t){return this._promise.addEventListener("loadstart",t),this},XHRActions.prototype.progress=function(t){return this._promise.addEventListener("progress",t),this},XHRActions.prototype.loadEnd=function(t){return this._promise.addEventListener("loadend",t),this},XHRActions.prototype.abort=function(t){return this._promise.addEventListener("abort",t),this},XHRActions.prototype.load=function(t){return this._promise.addEventListener("load",t),this},XHRActions.prototype.success=function(t){return this._promise.addEventListener("success",t),this},XHRActions.prototype.timeout=function(t){return this._promise.addEventListener("timeout",t),this},XHRActions.prototype.readyStateChange=function(t){return this._promise.addEventListener("readystatechange",t),this},XHRActions.prototype.then=function(t){return this._promise.queue.push(t),this},XHRActions.prototype.getXHR=function(){return this._promise.xhrCollection},XHRActions}(),function(t){"use strict";function XHRPromise(t){this.inProgress=!0,this.xhrCollection=new XHR.XHRCollection(this),void 0!==t&&this.xhrCollection.push(t),this.silent=!1,this.interceptors={},this.queue=[],this.actions=new XHR.XHRActions(this)}var e=t.Promise,r={request:"request",success:"response",error:"responseError",abort:"abort"};return XHRPromise.prototype=Object.create(EventTargetExtendable.prototype,{constructor:{value:XHRPromise}}),XHRPromise.prototype.destroy=function(){this.dispatchEvent("destroy"),this.inProgress=!1,this.removeAllListeners()},XHRPromise.prototype.applyCallback=function(t,n,o){var i=this,s=this.checkInterceptor(r[t],o),a=function(){var s=i.applyOwnInterceptor(r[t],n),a=function(e){i.dispatchEvent(t,e,o),"success"!==t&&"error"!==t&&"abort"!==t&&"timeout"!==t||i.destroy()};e&&s instanceof e?s.then(a,c):a(s)},c=function(){i.destroy()};e&&s instanceof e?s.then(a,c):s?a():i.destroy()},XHRPromise.prototype.checkInterceptor=function(t,e){return t&&"function"==typeof XHR.interceptors[t]?this.silent||XHR.interceptors[t](e):!0},XHRPromise.prototype.applyOwnInterceptor=function(t,e){var r=this.interceptors[t];return"function"==typeof r?r(e):e},XHRPromise.prototype.getNext=function(){return this.queue.shift()},XHRPromise.prototype.addToQueue=function(t){if(t instanceof XHR.XHRCollection){var e=this.xhrCollection,r=e.length,n=t.slice();n.unshift(0),n.unshift(r),e.splice.apply(e,n)}else this.xhrCollection.push(t);return this},XHRPromise}(this),function(){"use strict";function XHRCollection(t){Array.call(this),this.promise=t,this.aborted=!1}return XHRCollection.prototype=Object.create(Array.prototype,{constructor:{value:XHRCollection},abort:{value:function(){this.forEach(function(t){t instanceof XMLHttpRequest?t.abort():(clearTimeout(t),this.promise.applyCallback("abort"))},this),this.aborted=!0}}}),XHRCollection}());